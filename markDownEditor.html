<!DOCTYPE html>
<html>
<head>
    <title>Field selection demo</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript" src="./lib/field-selection.js"></script>

</head>
<body>

<button id="addBold">
	<span id="textBold" title="Bold">B</span>
</button>
<button id="addItalic" title="Italic">
	<span id="textItalic">I</span>
</button>
<button id="addUnderline" title="Underline">
	<span id="textUnderline">U</span>
</button>
<button id="addTachado" title="Scratch the text">
	<span id="textTachado">T</span>
</button>
<button id="addHorizontalRules" title="Add Horizontal Rule">
	<span id="textHorizontalRules">———</span>
</button>
<button id="addList" title="Add list">
	<span id="textList">+</span>
</button>
<button id="addH1" title="Add title H1">
	<span id="texttH1">H1</span>
</button>
<button id="addH2" title="Add title H2">
	<span id="texttH1">H2</span>
</button>
<button id="addH3" title="Add title H3">
	<span id="texttH1">H3</span>
</button>
<button id="addCodeInLine" title="Add code in line">
	<span id="textCodeInLine">Code</span>
</button>
<button id="addBlockquotes" title="Add blockquote">
	<span id="textBlockquotes">Blockquotes</span>
</button>
<button id="addLineReturn" title="Add line return">
	<span id="textLineReturn">Line Return</span>
</button>


<br />
<textarea id="textareaEditor" style="width: 100%; height: 200px;" placeholder="Digite o texto aqui...">
</textarea>

<script>
    (function() {
        var $elem;

        $('input, textarea').focus(function(){
            $elem = $(this);
        });

		$('#textareaEditor').bind('input propertychange', function(){	
			let txtValue = this.value;
			let htmlText = transformTextIntoMD(txtValue);
			$('#renderText').html(htmlText);
		});

        $('#addItalic').on('click', function() {
			$elem.fieldSelection('_' + $elem.fieldSelection().text + '_');
			returnCursor(1);
        });

		$('#addUnderline').on('click', function() {
			$elem.fieldSelection('__' + $elem.fieldSelection().text + '__');
        });

		$('#addTachado').on('click', function() {
			$elem.fieldSelection('~~' + $elem.fieldSelection().text + '~~');
        });
		
		$('#addCodeInLine').on('click', function() {
			$elem.fieldSelection('`' + $elem.fieldSelection().text + '`');
        });

		$('#addBold').on('click', function() {
			$elem.fieldSelection('**' + $elem.fieldSelection().text + '**');
        });

		$('#addHorizontalRules').on('click', function() {
			$elem.fieldSelection('- - -' + $elem.fieldSelection().text);
        });

		$('#addList').on('click', function() {
			$elem.fieldSelection($elem.fieldSelection().text.replace(/^/gm, '+ '));
		});
		
		$('#addH1').on('click', function() {
			$elem.fieldSelection('# ' + $elem.fieldSelection().text + '\n');
        });
		
		$('#addH2').on('click', function() {
			$elem.fieldSelection('## ' + $elem.fieldSelection().text + '\n');
        });

		$('#addH3').on('click', function() {
			$elem.fieldSelection('### ' + $elem.fieldSelection().text + '\n');
        });
		
		$('#addBlockquotes').on('click', function() {
			$elem.fieldSelection($elem.fieldSelection().text.replace(/^/gm, '> '));
        });
		
		$('#addLineReturn').on('click', function() {
			$elem.fieldSelection($elem.fieldSelection().text + '\s\s');
        });
		
		
		function returnCursor(positions) {
			if($elem.fieldSelection().length == 0) {
				let posicaoCursos = $('#textareaEditor').prop("selectionStart");
				$('#textareaEditor').prop('selectionEnd', (posicaoCursos-positions));
			}
		}

		var contTag = 2;
		function transformTextIntoMD(text){
			if(text.includes('- - -')){
				return transformTextIntoMD(insertHorizontalRules(text));
			} else if(text.match(/[_**~~]/)){
				contTag = contTag == 2 ? 1 : 2;
				return transformTextIntoMD(replaceText(contTag, text));
			} else if(text.match('# ')){
				return transformTextIntoMD(injectAloneTag(text));
			}
			contTag = 2;
			text = text.split(/\r?\n|\r/).join('<br>');
			console.log(text);
			return text;
			
		}

		function replaceText(oneTwo, text){
			if(oneTwo == 1){
				return startTag(text);
			} else {
				return endTag(text);
			}
		}

		function startTag(text) {
			return text.replace('___', '<i><u>')
						.replace('__', '<u>')
						.replace('_', '<i>')
						.replace('**', '<b>')
						.replace('~~', '<strike>');
		}

		function endTag(text){
			return text.replace('___', '</i></u>')
						.replace('__', '<u>')
						.replace('_', '</i>')
						.replace('**', '</b>')
						.replace('~~', '</strike>'); 
		}

		function injectAloneTag(text){
			let index = text.indexOf('### ');
			if(index >= 0){
				let brIndex = text.indexOf('\n', index);
				
				text = text.replaceAt(brIndex, '</h3>');
				text = text.replace('###', '<h3>');
			}
			
			index = text.indexOf('## ');
			if(index >= 0){
				//let brIndex = text.substr(index, text.length).indexOf('\n');
				
				text = text.replaceAt(index, '</h2>');
				text = text.replace('##', '<h2>');
			}
			
			index = text.indexOf('# ');
			if(index >= 0){
				let brIndex = text.indexOf('\n', index);
				
				text = text.replaceAt(brIndex, '</h1>');
				text = text.replace('#', '<h1>');
			}
			return text;
		}
		
		String.prototype.replaceAt=function(index, char) {
			var a = this.split("");
			a[index] = char;
			return a.join("");
		}


		function insertHorizontalRules(text){
			return text.replace('- - -', '<hr />');
		}

		function replaceAll(str, find, replace) {
			return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
		}

    }());

</script>
Fonte: https://github.com/kof/field-selection
<br/>
https://markdown-guide.readthedocs.io/en/latest/basics.html
<br/>
<span id="renderText">
</span>
<style>
#textTachado {
	text-decoration: line-through;
}
#textUnderline {
	text-decoration: underline;
}
#textItalic {
	font-style: italic;
}
#textBold {
	font-weight: bold;
}
</style>
</body>
</html>
